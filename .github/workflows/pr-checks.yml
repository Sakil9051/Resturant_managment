name: Pull Request Checks

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  pr-validation:
    name: Validate Pull Request
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      with:
        fetch-depth: 0

    - name: Check PR title
      uses: amannn/action-semantic-pull-request@v5
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: Check for merge conflicts
      run: |
        git fetch origin main
        git merge-base --is-ancestor origin/main HEAD || exit 1

    - name: Lint commit messages
      uses: wagoid/commitlint-github-action@v5

  size-check:
    name: Check Bundle Size
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Check file sizes
      run: |
        find . -type f -size +1M -not -path "./vendor/*" -not -path "./.git/*" | while read file; do
          echo "Warning: Large file detected: $file"
        done

  auto-assign:
    name: Auto Assign Reviewers
    runs-on: ubuntu-latest

    steps:
    - name: Auto assign
      uses: kentaro-m/auto-assign-action@v1.2.5
      with:
        configuration-path: '.github/auto-assign.yml'
